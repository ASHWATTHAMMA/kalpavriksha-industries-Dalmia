`<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <meta name="google" content="notranslate" />
    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/all.min.css"
    />
    <link rel="icon" type="image/png" href="../assets/images/favicon.png?v=2">
    <link rel="stylesheet" href="../assets/css/product-style.css" />
    <script src="../assets/js/translations.js"></script>
    <script src="../assets/js/language.js"></script>
    <script src="../assets/js/language-selector-loader.js"></script>
    <script src="../assets/js/header-loader.js"></script>
    <script src="../assets/js/footer-loader.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.0/dist/chart.umd.min.js"></script>
    <script type="module" src="https://ajax.googleapis.com/ajax/libs/model-viewer/3.4.0/model-viewer.min.js"></script>
    <title>Kalpavriksha Soil Quality Sensor</title>
  </head>

  <body>
    <div id="header-placeholder"></div>

    <main>
      <h1 class="product-title" data-i18n="soilSensorTitle">Kalpavriksha Soil Quality Sensor</h1>

      <div class="product-container">
        <div class="render-box">
          <model-viewer 
            src="../models/soil moisture sensor 3d model.glb" 
            alt="Soil Moisture Sensor 3D Model" 
            auto-rotate 
            camera-controls 
            shadow-intensity="1"
            style="width: 100%; height: 100%;">
          </model-viewer>
        </div>

        <div class="ph-scale-card">
          <h3 class="ph-scale-title" data-i18n="soilDashboardTitle">Dynamic Soil & pH Analysis Dashboard</h3>
          
          <div class="dashboard-container">
            <!-- Left: Soil Composition Pie Chart -->
            <div class="dashboard-left">
              <h4 class="section-title" data-i18n="soilComposition">Local Soil Composition</h4>
              <div class="composition-chart-container">
                <canvas id="compositionChart"></canvas>
              </div>
            </div>
            
            <!-- Right: pH Analysis -->
            <div class="dashboard-right">
              <h4 class="section-title" data-i18n="soilPHValue">Calculated Soil pH Value</h4>
              
              <div class="ph-analysis-container">
                <!-- pH Pointer -->
                <div class="ph-pointer" id="phPointer">
                  <div class="ph-value-label" id="phValueLabel">pH = 7.0</div>
                  <div class="ph-connector-line"></div>
                  <div class="ph-pointer-marker"></div>
                </div>
                
                <!-- pH Scale Bar -->
                <div class="ph-scale-bar-wrapper">
                  <div class="ph-scale-bar"></div>
                </div>
                
                <!-- pH Ticks -->
                <div class="ph-ticks">
                  <div class="ph-tick"><span>0</span></div>
                  <div class="ph-tick"><span>1</span></div>
                  <div class="ph-tick"><span>2</span></div>
                  <div class="ph-tick"><span>3</span></div>
                  <div class="ph-tick"><span>4</span></div>
                  <div class="ph-tick"><span>5</span></div>
                  <div class="ph-tick"><span>6</span></div>
                  <div class="ph-tick"><span>7</span></div>
                  <div class="ph-tick"><span>8</span></div>
                  <div class="ph-tick"><span>9</span></div>
                  <div class="ph-tick"><span>10</span></div>
                  <div class="ph-tick"><span>11</span></div>
                  <div class="ph-tick"><span>12</span></div>
                  <div class="ph-tick"><span>13</span></div>
                  <div class="ph-tick"><span>14</span></div>
                </div>
              </div>
            </div>
          </div>
          
          <p class="ph-caption" data-i18n="phCaption">pH value calculated based on sensor data and weighted soil composition analysis.</p>
        </div>

        <div class="nutrient-profile-card">
          <h3 class="nutrient-profile-title" id="nutrientProfileTitle"><span data-i18n="nutrientProfileTitle">Nutrient Profile for Dominant Soil:</span> <span data-i18n="loading">Loading...</span></h3>
          
          <div class="nutrient-columns">
            <div class="nutrient-column rich-column">
              <h4 class="nutrient-column-title">
                <i class="fa-solid fa-circle-check"></i>
                <span data-i18n="nutrientsRich">Nutrients RICH In (High)</span>
              </h4>
              <ul class="nutrient-list rich-list" id="richNutrientsList">
                <li><i class="fa-solid fa-check"></i> <span data-i18n="loading">Loading...</span></li>
              </ul>
            </div>
            
            <div class="nutrient-column poor-column">
              <h4 class="nutrient-column-title">
                <i class="fa-solid fa-circle-xmark"></i>
                <span data-i18n="nutrientsPoor">Nutrients POOR In (Deficient)</span>
              </h4>
              <ul class="nutrient-list poor-list" id="poorNutrientsList">
                <li><i class="fa-solid fa-xmark"></i> <span data-i18n="loading">Loading...</span></li>
              </ul>
            </div>
          </div>
        </div>

      </div>

      <div class="actionable-recommendations-card">
        <h3 class="recommendations-title" data-i18n="recommendationsTitle">Actionable Plan & Recommended Next Steps</h3>
        
        <p class="recommendations-summary" id="recommendationsSummary" data-i18n="recommendationsSummary">
          Based on your current soil conditions, follow these prioritized recommendations for optimal crop health.
        </p>
        
        <div class="recommendations-columns">
          <div class="recommendation-column immediate-actions">
            <div class="column-header immediate-header">
              <i class="fa-solid fa-clock"></i>
              <h4 data-i18n="immediateActions">Immediate Actions</h4>
            </div>
            
            <div class="action-list" id="immediateActionsList">
              <div class="action-item">
                <div class="action-number">1</div>
                <div class="action-content">
                  <h5>Monitor Soil Moisture</h5>
                  <p>Current pH levels are optimal. Continue regular monitoring.</p>
                </div>
              </div>
            </div>
          </div>
          
          <div class="recommendation-column longterm-actions">
            <div class="column-header longterm-header">
              <i class="fa-solid fa-seedling"></i>
              <h4 data-i18n="longTermSoilHealth">Long-Term Soil Health</h4>
            </div>
            
            <div class="action-list" id="longtermActionsList">
              <div class="action-item">
                <div class="action-number">1</div>
                <div class="action-content">
                  <h5>pH Monitoring</h5>
                  <p>Your pH is near optimal. Continue monitoring quarterly.</p>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>

      <div class="info-blocks-wrapper">
        <div class="info-card description-block">
          <h3 data-i18n="knowYourSoil">Know Your Soil. Grow with Confidence.</h3>
          <p data-i18n="soilDescText">
            An advanced IoT startup designed to measure pH levels, nutrient balance, and sunlight exposure. It helps farmers and gardeners make soil quality instantly, enabling smarter decisions for healthier crops and sustainability.
          </p>
          <p class="tagline" data-i18n="soilDescTagline">Know Your Soil. Grow with Confidence.</p>            
        </div>
      </div>
    </main>

    <div id="footer-placeholder"></div>

    <script>
      let compositionChart;

      const soilTypes = {
        'Alluvial Soil': { 
          min: 6.5, max: 8.4, color: '#A0826D',
          rich: ['Potash', 'Lime', 'Phosphoric Acid'],
          poor: ['Nitrogen (in drier areas)']
        },
        'Black Soil': { 
          min: 6.5, max: 8.4, color: '#4A4A4A',
          rich: ['Iron', 'Lime', 'Magnesium', 'Potash', 'Calcium Carbonates'],
          poor: ['Nitrogen', 'Phosphorus', 'Organic Matter']
        },
        'Red & Yellow Soil': { 
          min: 5.0, max: 7.5, color: '#CD853F',
          rich: ['Potash'],
          poor: ['Nitrogen', 'Phosphorus', 'Lime', 'Humus']
        },
        'Laterite Soil': { 
          min: 4.5, max: 5.5, color: '#C76E5C',
          rich: ['Iron Oxide', 'Aluminium Compounds'],
          poor: ['Nitrogen', 'Potash', 'Phosphorus', 'Lime', 'Organic Matter']
        },
        'Arid/Desert Soil': { 
          min: 7.6, max: 8.4, color: '#E8C89C',
          rich: ['Phosphate', 'Soluble Salts'],
          poor: ['Nitrogen', 'Humus', 'Moisture']
        },
        'Forest/Mountain Soil': { 
          min: 5.5, max: 6.5, color: '#6B8E4E',
          rich: ['Humus/Organic Matter', 'Iron', 'Aluminium'],
          poor: ['Potash', 'Phosphorus', 'Lime']
        }
      };

      function generateSoilComposition() {
        const allTypes = Object.keys(soilTypes);
        const numTypes = Math.floor(Math.random() * 2) + 3; // 3-4 types
        const selectedTypes = allTypes.sort(() => 0.5 - Math.random()).slice(0, numTypes);
        
        let percentages = [];
        let remaining = 100;
        
        for (let i = 0; i < selectedTypes.length - 1; i++) {
          const max = remaining - (selectedTypes.length - i - 1) * 10;
          const min = 15;
          const value = Math.floor(Math.random() * (max - min + 1)) + min;
          percentages.push(value);
          remaining -= value;
        }
        percentages.push(remaining);
        
        return selectedTypes.map((type, i) => ({
          type: type,
          percentage: percentages[i]
        }));
      }

      function calculateWeightedPH(composition) {
        let totalWeightedPH = 0;
        let totalWeight = 0;
        
        composition.forEach(item => {
          const soilData = soilTypes[item.type];
          const avgPH = (soilData.min + soilData.max) / 2;
          const weight = item.percentage;
          totalWeightedPH += avgPH * weight;
          totalWeight += weight;
        });
        
        const calculatedPH = totalWeightedPH / totalWeight;
        const variation = (Math.random() - 0.5) * 0.6;
        return Math.max(0, Math.min(14, calculatedPH + variation)).toFixed(1);
      }

      function updatePHPointer(phValue) {
        const pointer = document.getElementById('phPointer');
        const label = document.getElementById('phValueLabel');
        const percentage = (phValue / 14) * 100;
        
        pointer.style.left = percentage + '%';
        label.textContent = 'pH = ' + phValue;
      }

      function createCompositionChart(composition) {
        const ctx = document.getElementById('compositionChart').getContext('2d');
        
        if (compositionChart) {
          compositionChart.destroy();
        }

        compositionChart = new Chart(ctx, {
          type: 'pie',
          data: {
            labels: composition.map(item => item.type),
            datasets: [{
              data: composition.map(item => item.percentage),
              backgroundColor: composition.map(item => soilTypes[item.type].color),
              borderColor: '#fff',
              borderWidth: 3
            }]
          },
          options: {
            responsive: true,
            maintainAspectRatio: true,
            plugins: {
              legend: {
                position: 'bottom',
                labels: {
                  padding: 12,
                  font: {
                    size: 12,
                    family: 'Poppins, Inter, sans-serif',
                    weight: '500'
                  },
                  color: '#333',
                  usePointStyle: true,
                  pointStyle: 'circle'
                }
              },
              tooltip: {
                callbacks: {
                  label: function(context) {
                    return context.label + ': ' + context.parsed + '%';
                  }
                },
                backgroundColor: 'rgba(0, 0, 0, 0.8)',
                padding: 10,
                titleFont: {
                  size: 13,
                  family: 'Poppins, Inter, sans-serif'
                },
                bodyFont: {
                  size: 12,
                  family: 'Poppins, Inter, sans-serif'
                }
              }
            },
            animation: {
              animateRotate: true,
              animateScale: true,
              duration: 1200,
              easing: 'easeInOutQuart'
            }
          }
        });
      }

      function findDominantSoil(composition) {
        let dominant = composition[0];
        composition.forEach(item => {
          if (item.percentage > dominant.percentage) {
            dominant = item;
          }
        });
        return dominant;
      }

      function updateNutrientProfile(dominantSoil) {
        const soilData = soilTypes[dominantSoil.type];
        const title = document.getElementById('nutrientProfileTitle');
        const richList = document.getElementById('richNutrientsList');
        const poorList = document.getElementById('poorNutrientsList');
        
        title.textContent = `Nutrient Profile for Dominant Soil: ${dominantSoil.type}`;
        
        richList.innerHTML = soilData.rich.map(nutrient => 
          `<li><i class="fa-solid fa-check"></i> ${nutrient}</li>`
        ).join('');
        
        poorList.innerHTML = soilData.poor.map(nutrient => 
          `<li><i class="fa-solid fa-xmark"></i> ${nutrient}</li>`
        ).join('');
      }

      function generateRecommendations(composition, pH) {
        const dominantSoil = composition.reduce((max, item) => 
          item.percentage > max.percentage ? item : max
        );
        
        const soilData = soilTypes[dominantSoil.type];
        const immediateActions = [];
        const longtermActions = [];
        
        // pH-based recommendations
        if (pH < 5.5) {
          immediateActions.push({
            title: 'Critical: Raise Soil pH',
            description: `Your pH (${pH}) is too acidic. Apply lime immediately to raise pH to 6.0-7.0 range.`,
            icon: 'fa-triangle-exclamation'
          });
        } else if (pH > 7.5) {
          immediateActions.push({
            title: 'Critical: Lower Soil pH',
            description: `Your pH (${pH}) is too alkaline. Apply sulfur or organic matter to lower pH to 6.0-7.0 range.`,
            icon: 'fa-triangle-exclamation'
          });
        } else {
          longtermActions.push({
            title: 'pH Monitoring',
            description: `Your pH (${pH}) is near optimal. Continue monitoring quarterly and maintain current practices.`,
            icon: 'fa-check-circle'
          });
        }
        
        // Nutrient-based recommendations
        if (soilData.poor.length > 0) {
          const deficientNutrients = soilData.poor.join(', ');
          immediateActions.push({
            title: 'Address Nutrient Deficiencies',
            description: `Your ${dominantSoil.type} is deficient in: ${deficientNutrients}. Apply appropriate fertilizers.`,
            icon: 'fa-flask'
          });
        }
        
        // Soil-specific recommendations
        if (dominantSoil.type === 'Forest/Mountain Soil') {
          longtermActions.push({
            title: 'Add Organic Matter',
            description: 'Forest/Mountain soil benefits from continued organic material additions to maintain moisture retention and nutrient capacity.',
            icon: 'fa-leaf'
          });
        } else if (dominantSoil.type === 'Arid/Desert Soil') {
          immediateActions.push({
            title: 'Improve Water Retention',
            description: 'Arid soil loses water rapidly. Add compost and organic matter to improve water-holding capacity.',
            icon: 'fa-droplet'
          });
        } else if (dominantSoil.type === 'Red & Yellow Soil') {
          longtermActions.push({
            title: 'Regular Fertilization',
            description: 'Red & Yellow soil requires regular nitrogen and phosphorus supplementation for optimal crop growth.',
            icon: 'fa-seedling'
          });
        } else if (dominantSoil.type === 'Alluvial Soil') {
          longtermActions.push({
            title: 'Maintain Soil Quality',
            description: 'Your Alluvial soil is naturally fertile. Focus on crop rotation and balanced fertilization.',
            icon: 'fa-check-circle'
          });
        }
        
        // Rich nutrients - maintenance
        if (soilData.rich.length > 0) {
          longtermActions.push({
            title: 'Leverage Existing Nutrients',
            description: `Your soil is rich in: ${soilData.rich.join(', ')}. Optimize crop selection to benefit from these nutrients.`,
            icon: 'fa-star'
          });
        }
        
        // Summary
        let summary = '';
        if (pH < 5.5 || pH > 7.5) {
          summary = `Based on your ${pH < 5.5 ? 'acidic' : 'alkaline'} pH (${pH}) and ${dominantSoil.type} composition, prioritize pH correction followed by nutrient balancing.`;
        } else {
          summary = `Based on your optimal pH (${pH}) and ${dominantSoil.type} composition, focus on addressing nutrient deficiencies and maintaining soil health.`;
        }
        
        return { immediateActions, longtermActions, summary };
      }
      
      function renderRecommendations(recommendations) {
        document.getElementById('recommendationsSummary').textContent = recommendations.summary;
        
        const immediateList = document.getElementById('immediateActionsList');
        const longtermList = document.getElementById('longtermActionsList');
        
        immediateList.innerHTML = recommendations.immediateActions.map((action, index) => `
          <div class="action-item">
            <div class="action-number">${index + 1}</div>
            <div class="action-content">
              <h5><i class="fa-solid ${action.icon}"></i> ${action.title}</h5>
              <p>${action.description}</p>
            </div>
          </div>
        `).join('');
        
        longtermList.innerHTML = recommendations.longtermActions.map((action, index) => `
          <div class="action-item">
            <div class="action-number">${index + 1}</div>
            <div class="action-content">
              <h5><i class="fa-solid ${action.icon}"></i> ${action.title}</h5>
              <p>${action.description}</p>
            </div>
          </div>
        `).join('');
      }

      window.addEventListener('load', function() {
        const composition = generateSoilComposition();
        createCompositionChart(composition);
        
        const calculatedPH = calculateWeightedPH(composition);
        updatePHPointer(calculatedPH);
        
        const dominantSoil = findDominantSoil(composition);
        updateNutrientProfile(dominantSoil);
        
        const recommendations = generateRecommendations(composition, calculatedPH);
        renderRecommendations(recommendations);
      });
    </script>
  </body>
</html>
